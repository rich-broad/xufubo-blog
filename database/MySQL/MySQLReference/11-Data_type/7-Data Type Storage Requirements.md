# 7 数据类型存储需求
磁盘上表数据的存储要求取决于几个因素，不同的存储引擎存储行数据的方式也不同，甚至还会对表数据进行压缩，这些因素都会使计算磁盘上数据的存储要求变得复杂。  
尽管磁盘上的存储布局存在差异，但是，通信和交换有关表行信息的内部MySQL API使用 适用于所有存储引擎的一致数据结构。  
本节包含有关MySQL支持的每种数据类型存储要求的指南和信息。下边不涉及具体的存储引擎如何存放这些数据，如果需要这些资料，需要参考存储引擎的说明。    
即使存储引擎能够支持更大的行，表的内部表示也会限制最大的行大小为65535 **字节** （这不是存储引擎的限制，而是mysql服务器的限制，不同的存储引擎有不同的限制），这不包括BLOB或TEXT列，它们只向该大小贡献9到12个字节。对于 BLOB和 TEXT数据，内部存储在与行缓冲区不同的内存区域中。不同的存储引擎以不同的方式处理数据的分配和存储。更多信息见[Chapter 16, Alternative Storage Engines](https://dev.mysql.com/doc/refman/8.0/en/storage-engines.html), [Section C.10.4 Limits on Table Column Count and Row Size](https://dev.mysql.com/doc/refman/8.0/en/column-count-limit.html)。  

## 7.1 数值类型存储要求

|Data Type|Storage Required|  
|-|-|  
|TINYINT|1 byte|  
|SMALLINT|2 bytes|  
|MEDIUMINT|3 bytes|  
|INT, INTEGER|4 bytes|  
|BIGINT|8 bytes|  
|FLOAT(p)|4 bytes if 0 <= p <= 24, 8 bytes if 25 <= p <= 53|  
|FLOAT|4 bytes|  
|DOUBLE [PRECISION], REAL|8 bytes|  
|DECIMAL(M,D), NUMERIC(M,D)|Varies;见以下讨论|  
|BIT(M)|约 (M+7)/8 bytes|  

DECIMAL（和NUMERIC）列的值使用二进制格式表示，压缩九个十进制（基于10）位于4字节。对于每个值的整数和小数部分的存储将分别确定。每个九位数的倍数需要4字节，并且“剩余”数字需要4字节的一部分。剩余位数所需的存储根据以下表格给出：  

|剩余的位数|字节数|  
|-|-|  
|0|0|  
|1|1|  
|2|1|  
|3|2|  
|4|2|  
|5|3|  
|6|3|  
|7|4|  
|8|4|  

## 7.2 日期时间存储要求
对于TIME， DATETIME和 TIMESTAMP列，在MySQL 5.6.4之前创建的表所需的存储与从5.6.4创建的表不同。这是由于从5.6.4开始允许这些类型具有小数部分，这需要0到3个字节。  

|类型|5.6.4之前需要存储|从MySQL 5.6.4开始需要存储|  
|-|-|-|  
|YEAR|1 字节|1 字节|  
|DATE|3 字节|3 字节|  
|TIME|3 字节|3 字节 + 小数秒存储|  
|DATETIME|8 字节|5 字节 + 小数秒存储|  
|TIMESTAMP|4 字节|4 字节 + 小数秒存储|  

小数部分需要多少字节取决于小数精度。  

|小数秒精度|需要存储|  
|-|-|  
|0|0 字节|  
|1,2|1 字节|  
|3,4|2 字节|  
|5,6|3 字节|  

例如，TIME（0），TIME（2），TIME（4）和TIME（6）分别使用3,4,5和6个字节。 TIME和TIME（0）是等效的，需要相同的存储空间。  

## 7.3 字符串类型存储要求
下面的表， M 表示声明的非二进制字符串类型列的字符长度和二进制字符串的字节长度。 L 表示给定的字符串值的实际长度，以字节为单位。  

|列类型|存储需求|  
|-|-|  
|CHAR(M)|M * w 字节，0 <= M <=255， w 是字符集的最大长度字符所需的字节数|  
|BINARY(M)|M 字节, 0 <= M <= 255|  
|VARCHAR(M), VARBINARY(M)|L + 1(0 <= M <= 255), L + 2(M > 255)|  
|TINYBLOB, TINYTEXT|L + 1字节，其中 L < 2^8|  
|BLOB, TEXT|L + 2字节，其中 L < 2^16|  
|MEDIUMBLOB, MEDIUMTEXT|L + 3字节，其中 L < 2^24|  
|LONGBLOB, LONGTEXT|L + 4字节，其中 L < 2^32|  
|ENUM('value1','value2',...)|1或2字节，根据枚举值数目（最多65,535个值）|  
|SET('value1','value2',...)|1,2,3,4或8字节，根据set成员数目（最多64个成员）|  

使用长度前缀加真实数据存储可变长度字符串类型。长度前缀需要一到四个字节，具体取决于数据类型。  
VARCHAR，VARBINARY以及BLOB和TEXT类型是可变长度类型，存储要求取决于以下因素：  
 - 列值的实际长度(字节为单位)  
 - 列的最大可能长度  
 - 对于非二进制字符串，要考虑用于该列的字符集，因为某些字符集包含多字节字符  

非二进制字符串类型包括：CHAR，VARCHAR和TEXT    
可以存储在一个VARCHAR或VARBINARY列的最大有效 **字节**  数由65535字节的最大行尺寸决定，这是所有列都有的限制。对于VARCHAR列存储多字节字符， **字符**  的最大有效数目少于65535。例如，utf8字符可能每个字符需要多达3个字节，所以一个使用utf8字符集的VARCHAR列可以声明最多21844个字符。InnoDB将长度大于或等于768字节的固定长度字段编码为可变长度字段，可以在页外存储。例如，如果字符集的最大字节长度大于3，则CHAR（255）列可以超过768字节，此时，InnoDB就会将其编码为可变长度存储在页外。  

## 7.4 空间类型存储要求
LENGTH() 函数返回需要的字节空间，更加详细的说明，见[Section 11.5.3 Supported Spatial Data Formats](https://dev.mysql.com/doc/refman/8.0/en/gis-data-formats.html)。   

## 7.5 Json存储要求
通常，JSON列的存储要求与 LONGBLOB或 LONGTEXT列的存储要求 大致相同;但是，存储在JSON文档中的各个值的二进制编码（包括查找所需的元数据和字典）会产生开销。例如，存储在JSON文档中的字符串需要4到10个字节的额外存储空间，具体取决于字符串的长度以及存储它的对象或数组的大小。此外，MySQL对存储在JSON列中的任何JSON文档的大小施加了限制，使得它不能大于max_allowed_packet。  

# 8 选择正确的数据类型
通常，选择数据类型我们需要先选择大类，字符串、数值还是日期时间？选好大类之后，再选择大类中某个具体的类型，要选择正确的数据类型总结来看主要遵循如下几条：  
 - 正确性是前提
 - 值得范围预估充足的前提下，通常越小越好，因为小不仅节约存储，还可以减少磁盘IO（因为可以大量的在内存缓存）
 - 越简单越好，因为越简单，计算起来消耗的CPU越少，例如：整型的操作代价远小于字符串，因为字符串还涉及到排序规则等，存储IP地址也选用整数，可以节约大量空间。  
 - 尽量避免NULL（这个好理解，这个NULL通常是很多问题的根源）

这里注意：正确性是前提，不过这个正确性是与具体业务需求有关的，例如，如果准确性不是太重要或者速度是最高优先级，那么DOUBLE类型可能就足够了，如果准确性是最重要的，那么，就算性能低，也得选择DECIMAL。这也就是说： **产品经理需求不明确的时候让开发设计技术方案就是耍流氓**。  




